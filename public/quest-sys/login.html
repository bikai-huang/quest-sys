<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" class="gr__wjx_cn"><head id="Head1"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>
	北京师范大学问卷系统登录
</title><meta content="北京师范大学问卷系统" name="keywords">
       <link rel="stylesheet" href="./css/index.css" type="text/css">
       <script src="http://cdn.static.runoob.com/libs/jquery/2.1.1/jquery.min.js"></script>
       <script src="https://cdn.bootcss.com/jquery.form/4.2.1/jquery.form.js"></script>
       <script type="text/javascript" src="./js/common.js"></script>
    <style>
        .divAnti input {
            width: 140px !important;
            padding-left: 16px !important;
            border: none;
            height: 46px !important;
            line-height:46px !important;
            font-size: 14px;
            padding-left: 46px;
            border-radius: 100px;
            border: 1px solid #e6e6e6;
            float: left !important;
        }
    </style>
    <script src="./js/zhezhao.js" type="text/javascript"></script>
</head>
<body id="body1" class="fp-viewing" data-gr-c-s-loaded="true">
    <!--<form name="form" method="post" action="" id="form">-->
<div>
</div>

<div>

</div>
        <div class="fullpage-wrapper">
            <div class="full-head clearfix">
            <a href="https://" id="sojumplogo" class="logo pull-left">
                <!--<img src="./img/logo.png" alt="不止调查/考试/测评">-->
            </a>

        </div>
            <!-- <div class="fullpage-main"></div> -->
            <div id="divSojump" class="validate-box">
                <fieldset class="validate-wrapper">
                    <!-- <legend class="validate-caption">用户登录</legend> -->
                    <div class="questionLogo"><img src="./css/img/questionnaireIcon.png" alt="" /></div>
                    <div class="questionText"><img src="./css/img/LOGO.png" alt=""/></div>
                    <ul>
                        <li>
                            <label for="user-name" class="icon user-icon"></label>
                            <input name="login" id="UserName" placeholder="用户名/手机号/Email" class="validate-input user-name" type="text" onfocus="if(value==&#39;用户名/手机号&#39/Email;){value=&#39;&#39;;}" onblur="if(value==&#39;&#39;){value=&#39;用户名/手机号&#39/Email;}">
                            <div class="divclear"></div>
                        </li>
                        <li>
                            <label for="password" class="icon password-icon"></label>
                            <input name="password" type="password" id="Password" placeholder="密码" class="validate-input">
                        </li>
                        
                        

                    </ul>
                    <div id="trRemember" class="remember-box">
                        <span class="automatic-box pull-left">
                            <span class="checklist iCheck"><input id="RememberMe" type="checkbox" name="RememberMe" class="checkbox"></span>下次自动登录 
                        </span>
                        <a id="PasswordRecoveryLink" class="get-back pull-right" href="forget.html" >忘记用户名/密码？</a>
                    </div>
                </fieldset>
                <fieldset class="submit-wrapper" style="text-align: center; margin-top: 20px;">
                    <input type="submit" name="LoginButton" value="登 录" id="LoginButton" class="submitbutton" onmouseover="this.className=&#39;submitbutton submitbutton_hover&#39;;" onmouseout="this.className=&#39;submitbutton&#39;;" style="color:White;">
                    <span style="color: red; line-height: 28px;">
                    </span>
                    <button class="weChatLogin"><i class="weLogo"></i><span>微信登录</span></button>


                   <!-- <a href="#" id="hrefRegister" title="只需２０秒，就可完成注册" class="register-now">微信扫码注册</a>-->
                   <div class="school">
                        <div class="schoolLogo"></div>
                   </div>
                  
                    <script type="text/javascript">
                        /*切换check按钮*/
                        $(document).ready(function () {
                           //判断当前复选框状态，并让label背景图与复选框同步勾选或取消
                           $(".checkbox").click(function (){
                           //判断复选框勾选状态
                             if ($(this).is(':checked')) {
                                $(".checklist").removeClass("iCheck");    //删除未勾选选背景图
                                $(".checklist").addClass("iCheck-ed");    //添加勾选态背景图
                           }else{
                                $(".checklist").removeClass("iCheck-ed"); //删除勾选选背景图
                                $(".checklist").addClass("iCheck");       //添加未勾选选背景图
                           }
                          });
                        });

                        var UserName = document.getElementById("UserName");
                        //var hfUserName = document.getElementById("hfUserName");
                        var Password = document.getElementById("Password");
                        var LoginButton = document.getElementById("LoginButton");
                        var txtCode = document.getElementById("txtCode");
                        var hrefGetCode = document.getElementById("hrefGetCode");
                        function getCode() {
                            if (!UserName.value) {
                                alert("请先输入用户名"); UserName.focus(); return;
                            }
                            txtCode.focus();
                            //PDF_launch("/register/getcode.aspx?username=" + encodeURIComponent(hfUserName.value), 500, 150, codeCallBack);
                        }
                        function codeCallBack() {
                            txtCode.focus();
                        }
                        String.prototype.dbc2sbc = function () {
                            return this.replace(/[\uff01-\uff5e]/g, function (a) { return String.fromCharCode(a.charCodeAt(0) - 65248); }).replace(/\u3000/g, " ");
                        }
                        UserName.onkeypress = Password.onkeypress = function (e) {
                            e = e || window.event;
                            if (e && e.keyCode == 13) {
                                LoginButton.click();
                            }
                        }
                        UserName.onblur = UserName.onchange = function () {
                            var str = this.value;
                            var newstr = str.dbc2sbc();
                            if (str != newstr) this.value = newstr;
                            UserName.value = newstr;
                        }
                        if (txtCode) txtCode.onkeydown = UserName.onkeydown;
                        if (UserName.value) Password.focus();
                        else UserName.onblur();
                        
								
								$(function () {
									$('#LoginButton').click(function() {
											loginFun();
									 });

                                     $('#PasswordRecoveryLink').click(function() {
                                        location.href = 'forget.html';
									 });
                                     
 								 });
			
								var loginCount ;
								function loginFun() {
									$.ajax({
											url: host + '/api/login?channel=pc',
											type: "GET",
											dataType: "json", 
											data: {login: UserName.value, password: Password.value},
											cache: false,
											success: function(result) {
												if (result.state == 200) {
											     var token = result.data.token;
												  localStorage.setItem('token', token);
												  var nickname = result.data.nickname;
                                                  localStorage.setItem('nickname', nickname);
                                                  var roleType = result.data.roleType;
                                                  //todo
                                                  localStorage.setItem('roleType', roleType);
                                                  localStorage.setItem('login', result.data.login);
                                                  
												  location.href = 'paper-list.html';
												} else {
													alert(result.data.error);
												}
											},
											error: function(XMLHttpRequest, textStatus, errorThrown) {
												console.log('login fail ' + loginCount);
												if(loginCount<3) {
													loginCount = loginCount + 1;
													loginFun();
												}else {
													loginCount = 0;
												}
      										}
										});								
								}
                    </script>
                </fieldset>
            </div>
        </div>
    <!--</form>-->


</body></html>